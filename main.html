<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sybernake</title>
    <link rel="stylesheet" href="css/emoji-select.css">
    <link rel="stylesheet" href="css/endgame.css">
    <link rel="stylesheet" href="css/scale.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/form.css">
</head>
<body>

<div class="scanlines"></div>
<div class="container">

    <div class="neon-title">
        <div class="neon-title-text">Sybernake</div>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="settings">æ¸¸æˆä»‹ç»</div>
        <div class="tab" data-tab="characters">è§’è‰²ä»‹ç»</div>
        <div class="tab" data-tab="leaderboard">æ’è¡Œæ¦œ</div>
        <div class="tab" data-tab="game">å¼€å§‹æ¸¸æˆ</div>
    </div>

    <!-- æ¸¸æˆè®¾ç½®é¢æ¿ -->
    <div id="settings" class="tab-content active">
        <div class="settings-panel">
            <h2 class="settings-title">æ¸¸æˆå†…å®¹</h2>
            <div class="difficulty-options">
                <div class="difficulty-option selected" data-difficulty="easy">
                    <div class="difficulty-emoji">ğŸğŸ‰</div>

                    <div class="difficulty-name">æ“ä½œä»‹ç»</div>
                    <div class="difficulty-desc">é€šè¿‡âŒ¨ï¸æ§åˆ¶è›‡å¤´ç§»åŠ¨
                        <br>ğŸ‘†å‰è¿›
                        <br>ğŸ‘ˆå·¦è½¬
                        <br>ğŸ‘‰å³è½¬
                    </div>
                    <br>
                    <div class="difficulty-desc">é€šè¿‡ğŸ®æ§åˆ¶è›‡å¤´ç§»åŠ¨
                        <br>LTå‰è¿›
                        <br>Lè½¬å‘
                    </div>
                    <br>

                    <div class="difficulty-name">æ¸¸æˆè®¾å®š</div>
                    <div class="difficulty-desc">å‡»æ€æ•Œäºº ç‚¹äº®ç»“ç‚¹</div>
                    <div class="difficulty-desc">ç‚¹äº®æ‰€æœ‰ æŠ½å–ç»“ç‚¹</div>
                </div>
            </div>
        </div>
    </div>

    <!-- è§’è‰²é€‰æ‹©é¢æ¿ -->
    <div id="characters" class="tab-content">
        <h2 class="settings-title">ä½œæˆ˜å•ä½</h2>
        <div class="characters-grid">
            <div class="character-card selected" data-character="common">
                <div class="character-emoji">ğŸ˜€ğŸ˜€</div>
                <div class="character-name">å“ˆå“ˆ</div>
                <div class="character-stats">
                    <div><span class="stat-icon">ğŸ”¥</span> åŠ¨å¸§æ ¼çš„</div>
                    <div><span class="stat-icon">ğŸ˜¶â€ğŸŒ«ï¸ğŸ˜¶â€ğŸŒ«ï¸</span> äº¡è¯­æ¸…å±</div>
                    <div><span class="stat-icon">âš”âš”ï¸</span> å¹³è¡¡å‹å•ä½</div>
                </div>
            </div>

            <div class="character-card" data-character="robot">
                <div class="character-emoji">ğŸ¤–ğŸ¤–</div>
                <div class="character-name">Bot</div>
                <div class="character-stats">
                    <div><span class="stat-icon">âš¡</span> åä¸‡ä¼ç‰¹</div>
                    <div><span class="stat-icon">ğŸ‘€ğŸ‘€</span> è¶…è¿œå°„ç¨‹</div>
                    <div><span class="stat-icon">ğŸ¹ğŸ¹</span> ç‹™å‡»å‹å•ä½</div>
                </div>
            </div>

            <div class="character-card" data-character="seak">
                <div class="character-emoji">ğŸ¤¢ğŸ¤¢</div>
                <div class="character-name">çº³å¢ç¥é€‰</div>
                <div class="character-stats">
                    <div><span class="stat-icon">ğŸ¦ ğŸ¦ ğŸ¦ </span> è¯¶å‘¦ç–«æƒ…</div>
                    <div><span class="stat-icon">ğŸ—¡ğŸ—¡ï¸</span> è¿‘æˆ˜æ”»å‡»</div>
                    <div><span class="stat-icon">ğŸ§ªğŸ”ª</span> è¿‘æˆ˜å‹å•ä½</div>
                </div>
            </div>

            <div class="character-card" data-character="bomb">
                <div class="character-emoji">ğŸ¤¯ğŸ¤¯</div>
                <div class="character-name">ä¸è¦è¯´ä¿„è¯­</div>
                <div class="character-stats">
                    <div><span class="stat-icon">ğŸ’£</span> ææ€–è¢­å‡»</div>
                    <div><span class="stat-icon">ğŸ’¥ğŸ’¥</span> èŒƒå›´çˆ†ç‚¸</div>
                    <div><span class="stat-icon">ğŸ‡ğŸ§¨</span> çˆ†ç ´å‹å•ä½</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œé¢æ¿ -->
    <div id="leaderboard" class="tab-content">
        <div class="leaderboard">
            <h2 class="leaderboard-title">æ’è¡Œæ¦œ</h2>

            <div class="leaderboard-item">
                <div class="rank">1</div>
                <div class="player-info">
                    <div class="player-name" id="p1">è™šä½ä»¥å¾…</div>
                    <div class="player-details">
                        <span id="d1">2025-6-1</span>
                    </div>
                </div>
                <div class="player-score" id="k1">0</div>
            </div>

            <div class="leaderboard-item">
                <div class="rank">2</div>
                <div class="player-info">
                    <div class="player-name" id="p2">è™šä½ä»¥å¾…</div>
                    <div class="player-details">
                        <span id="d2">2025-6-1</span>
                    </div>
                </div>
                <div class="player-score" id="k2">0</div>
            </div>

            <div class="leaderboard-item">
                <div class="rank">3</div>
                <div class="player-info">
                    <div class="player-name" id="p3">è™šä½ä»¥å¾…</div>
                    <div class="player-details">
                        <span id="d3">2025-6-1</span>
                    </div>
                </div>
                <div class="player-score" id="k3">0</div>
            </div>

            <div class="leaderboard-item">
                <div class="rank">4</div>
                <div class="player-info">
                    <div class="player-name" id="p4">è™šä½ä»¥å¾…</div>
                    <div class="player-details">
                        <span id="d4">2025-6-1</span>
                    </div>
                </div>
                <div class="player-score" id="k4">0</div>
            </div>

            <div class="leaderboard-item">
                <div class="rank">5</div>
                <div class="player-info">
                    <div class="player-name" id="p5">è™šä½ä»¥å¾…</div>
                    <div class="player-details">
                        <span id="d5">2025-6-1</span>
                    </div>
                </div>
                <div class="player-score" id="k5">0</div>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆé¢æ¿ -->
    <div id="game" class="tab-content" style="position: relative;">
        <canvas id="canvas" width="600" height="500"></canvas>
        <div id="pauseOverlay" class="pause-overlay">
            <div class="pause-text">æ¸¸æˆæš‚åœ</div>
        </div>
        <div id="scoreDisplay" class="score-display">å¾—åˆ†: <span id="scoreValue">0</span></div>
    </div>

    <!-- æŒ‰é’®åŒºåŸŸ -->
    <div class="action-buttons">
        <button class="btn btn-primary" id="startGame" style="display: none;">å¯åŠ¨æ¸¸æˆ</button>
        <button class="btn btn-secondary" id="pauseGame" style="display: none;">æš‚åœæ¸¸æˆ</button>
    </div>
</div>


<!-- Emojié€‰æ‹©æ¨¡æ€æ¡† -->
<div id="emojiModal" class="modal-emoji">
    <div class="modal-content-emoji">
        <div class="modal-header-emoji">
            <h2 class="emoji-selection-text">é€‰æ‹©ä½ çš„è‹±é›„ğŸ«¶</h2>
        </div>
        <div class="modal-body-emoji">
            <div class="emoji-options">
                <!-- é»˜è®¤è¡¨æƒ… -->
                <div id="op1" class="emoji-option" data-emoji="ğŸ˜Š">ğŸ˜Š</div>
                <div id="op2" class="emoji-option" data-emoji="ğŸ˜‚">ğŸ˜‚</div>
                <div id="op3" class="emoji-option" data-emoji="ğŸ˜">ğŸ˜</div>
            </div>
            <div class="modal-buttons-emoji">
                <button class="modal-btn submit-btn emoji" id="submitEmoji">ç¡®å®šé€‰æ‹©</button>
            </div>
        </div>
    </div>
</div>

<!--  ç»“æŸæ¸¸æˆå±•ç¤ºæ¡†  -->
<div id="gameEndModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h2>æ¸¸æˆç»“æŸ</h2>
        <p>ä½ çš„æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>

        <p>
            <input type="text" class="name-input" id="playerName" placeholder="è¾“å…¥ä½ çš„åå­—" maxlength="15">
        </p>

        <div class="modal-buttons">
            <button id="restartButton">ç»“æŸ</button>
        </div>
    </div>
</div>





<script type="module">
    import {startGame, togglePause} from "./index.js";
    import {refreshRank} from './game/setRank.js'

    refreshRank();

    // æ¸¸æˆçŠ¶æ€ç®¡ç†
    const gameState = {
        difficulty: 'normal',
        character: 'common',
        gameActive: false,
        currentGame: null,
        isPaused: false
    };

    // DOMå…ƒç´ å¼•ç”¨
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const difficultyOptions = document.querySelectorAll('.difficulty-option');
    const characterCards = document.querySelectorAll('.character-card');
    const gameCanvas = document.getElementById('canvas');
    const scoreValue = document.getElementById('scoreValue');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const startGameButton = document.getElementById('startGame');
    const pauseGameButton = document.getElementById('pauseGame');
    const pauseOverlay = document.getElementById('pauseOverlay');

    // åˆå§‹åŒ–åº”ç”¨
    function initApp() {
        initEventListeners();
        initGameCanvas();
        updateButtonVisibility('settings'); // åˆå§‹åŒ–æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
    }

    // åˆå§‹åŒ–æ¸¸æˆç”»å¸ƒ
    function initGameCanvas() {
        if (gameCanvas.getContext) {
            const ctx = gameCanvas.getContext('2d');
            // ç»˜åˆ¶ç®€å•çš„èƒŒæ™¯
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);

            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = 'rgba(0, 150, 255, 0.1)';
            ctx.lineWidth = 1;

            // å‚ç›´çº¿
            for (let x = 0; x < gameCanvas.width; x += 20) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, gameCanvas.height);
                ctx.stroke();
            }

            // æ°´å¹³çº¿
            for (let y = 0; y < gameCanvas.height; y += 20) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(gameCanvas.width, y);
                ctx.stroke();
            }

            // ç»˜åˆ¶æ¸¸æˆæ ‡é¢˜
            ctx.fillStyle = '#00e5ff';
            ctx.font = 'bold 32px "Arial", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Sybernake', gameCanvas.width/2, gameCanvas.height/2 - 25);

            ctx.fillStyle = '#b0f0ff';
            ctx.font = '16px "Arial", sans-serif';
            ctx.fillText('å‡†å¤‡è¿›å…¥éœ“è™¹æˆ˜åœº', gameCanvas.width/2, gameCanvas.height/2 + 15);
        }
    }

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
    function initEventListeners() {
        // æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
                tabs.forEach(t => t.classList.remove('active'));
                // æ·»åŠ å½“å‰æ ‡ç­¾çš„activeç±»
                tab.classList.add('active');

                // éšè—æ‰€æœ‰å†…å®¹é¢æ¿
                tabContents.forEach(content => content.classList.remove('active'));

                // æ˜¾ç¤ºå½“å‰å†…å®¹é¢æ¿
                const tabId = tab.dataset.tab;
                document.getElementById(tabId).classList.add('active');

                // å¦‚æœæ˜¯æ¸¸æˆæ ‡ç­¾ï¼Œæ˜¾ç¤ºç”»å¸ƒ
                if (tabId === 'game') {
                    gameCanvas.style.display = 'block';
                    startGameButton.style.display = 'block'; // æ˜¾ç¤ºå¯åŠ¨æ¸¸æˆæŒ‰é’®
                    pauseGameButton.style.display = 'block'; // æ˜¾ç¤ºæš‚åœæ¸¸æˆæŒ‰é’®
                } else {
                    gameCanvas.style.display = 'none';
                    startGameButton.style.display = 'none'; // éšè—å¯åŠ¨æ¸¸æˆæŒ‰é’®
                    pauseGameButton.style.display = 'none'; // éšè—æš‚åœæ¸¸æˆæŒ‰é’®
                }
            });
        });

        // éš¾åº¦é€‰æ‹©åŠŸèƒ½
        difficultyOptions.forEach(option => {
            option.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰é€‰é¡¹çš„selectedç±»
                difficultyOptions.forEach(opt => opt.classList.remove('selected'));
                // æ·»åŠ å½“å‰é€‰é¡¹çš„selectedç±»
                option.classList.add('selected');

                // ä¿å­˜å½“å‰é€‰æ‹©çš„éš¾åº¦
                gameState.difficulty = option.dataset.difficulty;

                // æ·»åŠ è§†è§‰åé¦ˆ
                option.style.animation = 'neon-pulse 0.5s';
                setTimeout(() => {
                    option.style.animation = '';
                }, 500);
            });
        });

        // è§’è‰²é€‰æ‹©åŠŸèƒ½
        characterCards.forEach(card => {
            card.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰è§’è‰²çš„selectedç±»
                characterCards.forEach(c => c.classList.remove('selected'));
                // æ·»åŠ å½“å‰è§’è‰²çš„selectedç±»
                card.classList.add('selected');

                // ä¿å­˜å½“å‰é€‰æ‹©çš„è§’è‰²
                gameState.character = card.dataset.character;

                // æ·»åŠ è§†è§‰åé¦ˆ
                card.style.animation = 'neon-pulse 0.5s';
                setTimeout(() => {
                    card.style.animation = '';
                }, 500);
            });
        });

        // å¼€å§‹æ¸¸æˆæŒ‰é’®
        document.getElementById('startGame').addEventListener('click', () => {
            if (gameState.currentGame) {
                startGame();
                // gameState.currentGame.restart();
                // gameState.currentGame = null;
            }

            gameState.gameActive = true;
            gameState.isPaused = false;
            // åˆ‡æ¢åˆ°æ¸¸æˆæ ‡ç­¾
            const gameTab = document.querySelector('.tab[data-tab="game"]');
            gameTab.click();

            // é‡ç½®å¾—åˆ†æ˜¾ç¤º
            gameState.score = 0;
            scoreValue.textContent = gameState.score;
            scoreDisplay.style.display = 'block';

            // è§†è§‰åé¦ˆ
            document.getElementById('startGame').style.animation = 'neon-pulse 0.5s';
            setTimeout(() => {
                document.getElementById('startGame').style.animation = '';
            }, 500);

            // å¯åŠ¨æ¸¸æˆ
            startGame();

            // ç¡®ä¿æ‰€æœ‰æŒ‰é’®å¤„äºå¯ç”¨çŠ¶æ€
            pauseGameButton.classList.remove('btn-disabled');
            pauseGameButton.disabled = false;
        });

        // æš‚åœæ¸¸æˆæŒ‰é’®
        document.getElementById('pauseGame').addEventListener('click', () => {
            const isPausedNow = togglePause();
            gameState.isPaused = isPausedNow;

            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            if (isPausedNow) {
                pauseGameButton.textContent = 'ç»§ç»­æ¸¸æˆ';
                pauseOverlay.style.display = 'flex'; // æ˜¾ç¤ºæš‚åœè¦†ç›–å±‚

                // ç¦ç”¨å…¶ä»–æŒ‰é’®
                startGameButton.classList.add('btn-disabled');
                startGameButton.disabled = true;
            } else {
                pauseGameButton.textContent = 'æš‚åœæ¸¸æˆ';
                pauseOverlay.style.display = 'none'; // éšè—æš‚åœè¦†ç›–å±‚

                // å¯ç”¨å…¶ä»–æŒ‰é’®
                startGameButton.classList.remove('btn-disabled');
                startGameButton.disabled = false;
            }

            // è§†è§‰åé¦ˆ
            pauseGameButton.style.animation = 'neon-pulse 0.5s';
            setTimeout(() => {
                pauseGameButton.style.animation = '';
            }, 500);
        });

    }

    // æ›´æ–°æŒ‰é’®å¯è§æ€§
    function updateButtonVisibility(tabId) {
        if (tabId === 'game') {
            startGameButton.style.display = 'block';
            pauseGameButton.style.display = 'block';
        } else {
            startGameButton.style.display = 'none';
            pauseGameButton.style.display = 'none';
        }
    }

    // å¯åŠ¨åº”ç”¨
    document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>